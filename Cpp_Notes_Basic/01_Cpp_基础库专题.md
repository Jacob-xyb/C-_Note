# memset

memset是一个初始化函数，作用是将某一块内存中的全部设置为指定的值。

```cpp
void *memset(void *s, int c, size_t n); 
```

- s指向要填充的内存块。
- c是要被设置的值。
- n是要被设置该值的字符数。
- 返回类型是一个指向存储区s的指针。

## memset 初始化的方式

memset函数是按照**字节**对内存块进行初始化，所以不能用它将int数组初始化为0和-1之外的其他值（除非该值高字节和低字节相同）。
其实c的实际范围应该在0~255，因为memset函数只能**取c的后八位**给所输入范围的每个字节。也就是说**无论c多大只有后八位二进制是有效的**。

对于int a[4];
memset(a, -1, sizeof(a)) 与 memset(a, 511, sizeof(a)) 所赋值的结果一样都为-1：
因为 -1 的二进制码为（11111111 11111111 11111111 11111111）；511 的二进制码为（00000000 00000000 00000001 11111111）；
后八位均为（11111111），所以数组中的每个字节都被赋值为（11111111）。
注意int占四个字节，例如a[0]的四个字节都被赋值为（11111111），那么a[0]（11111111 11111111 11111111 11111111），即a[0] = -1。

## 注意所要赋值的数组的元素类型

**例一：对char类型的数组a初始化，设置元素全为’1’**

```cpp
int main(){
    char a[4];
    memset(a,'1',4);
    for(int i=0; i<4; i++){
        cout<<a[i]<<" ";
    }
    return 0;
}
```

> 输出： 1 1 1 1

**例二：对int类型的数组a初始化，设置元素值全为1**

```cpp
int main(){
    int a[4];
    memset(a,1,sizeof(a));
    for(int i=0; i<4; i++){
        cout<<a[i]<<" ";
    }
    return 0;
}
```

> 输出：16843009 16843009 16843009 16843009

如果长度写成了4:  `memset(a,1,4);`

就会发生下述情况 

>  输出：16843009 0 0 0 

由于memset函数是以字节为单位进行赋值的，所以上述代码是**为数组a的前4个字节进行赋值**

- **为什么第一个程序可以正确赋值1而第二个不可以？**

这就又回到了刚刚说的第一个问题，memset函数中只能取c的后八位赋给每个字节。

第一个程序中，数组a是字符型的，字符型占据的内存大小就是1Byte，而memset函数也是以字节为单位进行赋值的，所以输出正确。
第二个程序中，数组a是整型的，整型占据的内存大小为4Byte，而memset函数还是按照字节为单位进行赋值，将1（00000001）赋给每一个字节。那么对于a[0]来说，其值为(00000001 00000001 00000001 00000001），即十进制的16843009。

## 实际开发可能遇到的问题

### 数组指针

```cpp
#include<bits/stdc++.h>
using namespace std;

void fun1(int a[]){
    memset(a,-1,sizeof(a)); 
}

int main(){
    int a[6];
    fun1(a);
    for(int i=0; i<6; i++){
        cout<<a[i]<<" ";
    }
    return 0;
}
```

当数组作为参数传递时，其**传递的实际上是一个指针**，这个指针指向数组的首地址，如果用**sizeof(a)函数得到的只是指针的长度**，而不是数组的长度。

解决方案：在函数中加入数组长度参数，在传递前先获取数组长度，然后将数组长度作为参数传递进去。

```cpp
#include<bits/stdc++.h>
using namespace std;

void fun1(int a[], int len){
    memset(a,-1,len); 
}

int main(){
    int a[6];
    int len = sizeof(a);
    fun1(a,len);
    for(int i=0; i<6; i++){
        cout<<a[i]<<" ";
    }
    return 0;
}
```

## 常用场景

- 初始化数组

```cpp
char str[100];
memset(str,0,100);

char str[100];
memset(str,'\0',100);
```

- 清空结构体类型的变量

```cpp
typedef struct Stu{
	char name[20];
	int cno;
}Stu;
Stu stu1; 
memset(&stu1, 0 ,sizeof(Stu));

Stu stu2[10]; //数组
memset(stu2, 0, sizeof(Stu)*10);
```

此外，如果结构体中有数组的话还是需要对数组单独进行初始化处理的。